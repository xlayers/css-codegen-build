!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@xlayers/sketch-lib")):"function"==typeof define&&define.amd?define("@xlayers/css-codegen",["exports","@angular/core","@xlayers/sketch-lib"],e):e(((t=t||self).xlayers=t.xlayers||{},t.xlayers["css-codegen"]={}),t.ng.core,t.sketchLib)}(this,(function(t,e,r){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var o=function(){return(o=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function n(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],o=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return s}function s(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t}var a=function(){function t(){}return t.prototype.identify=function(t){return["rect","page","rectangle","group","oval","slice","MSImmutableHotspotLayer","text","triangle","shapePath","shapeGroup"].includes(t._class)},t.prototype.of=function(t){return t.css},t.prototype.put=function(t,e){t.css=o({},this.of(t),e)},t.prototype.clear=function(t){delete t.web},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),c=function(){function t(t,e,r,o){this.styleHelperService=t,this.cssContext=e,this.symbolService=r,this.layerService=o}return t.prototype.compute=function(t,e,r){var o=this;"page"===t._class?t.layers.forEach((function(t){o.flattenLayer(t),o.visit(t,e,r)})):this.visit(t,e,r)},t.prototype.flattenLayer=function(t){t.frame.x=0,t.frame.y=0},t.prototype.walk=function(t,e,r){var o=this;if(this.layerService.identify(t))t.layers.forEach((function(t){o.visit(t,e,r)}));else if(this.symbolService.identify(t))return this.visitSymbol(t,e,r)},t.prototype.visit=function(t,e,r){r.force&&this.cssContext.clear(t),this.cssContext.identify(t)&&(this.cssContext.of(t)||this.visitContent(t,r)),this.walk(t,e,r)},t.prototype.visitSymbol=function(t,e,r){var o=this.symbolService.lookup(t,e);o&&this.compute(o,e,r)},t.prototype.visitContent=function(t,e){switch(e.generateClassName&&this.cssContext.put(t,{className:this.generateCssClassName(e)}),t._class){case"rectangle":this.visitRectangleStyle(t);break;case"text":this.visitTextStyle(t);break;case"oval":this.visitOvalStyle(t);break;default:this.visitLayerStyle(t)}},t.prototype.visitLayerStyle=function(t){this.cssContext.put(t,{rules:o({},this.extractFrame(t),this.extractRotation(t),this.extractBorderRadius(t),this.extractOpacity(t))})},t.prototype.visitRectangleStyle=function(t){this.cssContext.put(t,{rules:o({},this.extractFrame(t),this.extractBorders(t),this.extractFills(t),this.extractShadows(t)),pseudoElements:{before:this.extractBlurPseudoElement(t)}})},t.prototype.visitOvalStyle=function(t){this.cssContext.put(t,{rules:o({},this.addOvalShape(),this.extractFrame(t),this.extractBorders(t),this.extractFills(t),this.extractShadows(t)),pseudoElements:{before:this.extractBlurPseudoElement(t)}})},t.prototype.visitTextStyle=function(t){this.cssContext.put(t,{rules:o({},this.extractFrame(t),this.extractTextFont(t),this.extractTextColor(t),this.extractParagraphStyle(t))})},t.prototype.extractFrame=function(t){return t.frame?{display:"block",position:"absolute",left:t.frame.x+"px",top:t.frame.y+"px",width:t.frame.width+"px",height:t.frame.height+"px",visibility:t.isVisible?"visible":"hidden"}:{}},t.prototype.extractTextColor=function(t){var e=t.style.textStyle.encodedAttributes;return e.hasOwnProperty("MSAttributedStringColorAttribute")?{color:this.styleHelperService.parseColorAsRgba(e.MSAttributedStringColorAttribute)}:e.hasOwnProperty("NSColor")?{}:{color:"black"}},t.prototype.extractParagraphStyle=function(t){return t.style.textStyle.encodedAttributes.hasOwnProperty("NSParagraphStyle"),{}},t.prototype.extractTextFont=function(t){var e=t.style.textStyle.encodedAttributes.MSAttributedStringFontAttribute;return e.hasOwnProperty("_class")&&"fontDescriptor"===e._class?{"font-family":"'"+e.attributes.name+"', 'Roboto', 'sans-serif'","font-size":e.attributes.size+"px"}:(e.hasOwnProperty("_archive"),{})},t.prototype.addOvalShape=function(){return{"border-radius":"50%"}},t.prototype.extractOpacity=function(t){return t.opacity?{opacity:""+t.opacity}:{}},t.prototype.extractBorderRadius=function(t){var e=t.fixedRadius;return e?{"border-radius":e.fixedRadius+"px"}:{}},t.prototype.extractRotation=function(t){return t.rotation?{transform:"rotate("+t.rotation+"deg)"}:{}},t.prototype.extractBlurPseudoElement=function(t){var e=t.style.blur;if(e&&e.hasOwnProperty("radius")&&e.radius>0){var r=t.style.fills;if(r&&r.length>0){var o=r[0];if(o.isEnabled){var n=this.styleHelperService.parseColorAsRgba(o.color);return{height:t.frame.height+50+"px",width:t.frame.width+50+"px",content:'""',position:"absolute",top:"-25px",left:"-25px",bottom:"0",right:"0",background:"inherit","box-shadow":"inset 0 0 0 "+t.frame.width/2+"px "+n,filter:"blur("+e.radius.toFixed(2)+"px)"}}}}return{}},t.prototype.extractBorders=function(t){var e=this,r={INSIDE:1,OUTSIDE:2,CENTER:0};r[r.INSIDE]="INSIDE",r[r.OUTSIDE]="OUTSIDE",r[r.CENTER]="CENTER";var o=t.style.borders;if(o&&o.length>0){var n=o.reduce((function(t,o){if(o.thickness>0){var n=e.styleHelperService.parseColorAsRgba(o.color),i=o.position===r.INSIDE?"inset":"";return s([["0 0 0 "+o.thickness+"px "+n,i].join(" ")],t)}return t}),[]);if(n.length>0)return{"box-shadow":n.join(",")}}return{}},t.prototype.extractFills=function(t){var e=t.style.fills;if(e&&e.length>0){var r=e[0];if(r.isEnabled){var n=this.styleHelperService.parseColorAsRgba(r.color),i=t.style.blur;return i&&i.hasOwnProperty("radius")&&i.radius>0?o({},this.extractFillGradient(r),{background:"inherit",overflow:"hidden","background-color":n}):o({},this.extractFillGradient(r),{"background-color":n})}}return{}},t.prototype.extractFillGradient=function(t){var e=this;if(t.gradient){var r=t.gradient.stops.map((function(t){var r=t.position>=0&&t.position<=1?" "+100*t.position+"%":"";return""+e.styleHelperService.parseColorAsRgba(t.color)+r}));if(r.length>0)return{background:"linear-gradient(90deg, "+r.join(",")+")"}}return{}},t.prototype.extractShadows=function(t){var e=this.extractInnerShadow(t),r=this.extractOuterShadow(t);return e+r!==""?{"box-shadow":e+r}:{}},t.prototype.extractInnerShadow=function(t){var e=this,r=t.style.innerShadows;return r?r.map((function(t){var r=e.styleHelperService.parseColorAsRgba(t.color);return[t.offsetX+"px",t.offsetY+"px",t.blurRadius+"px",t.spread+"px",""+r,"inset"].join(" ")})):""},t.prototype.extractOuterShadow=function(t){var e=this,r=t.style.shadows;return r?r.map((function(t){var r=e.styleHelperService.parseColorAsRgba(t.color);return[t.offsetX+"px",t.offsetY+"px",t.blurRadius+"px",t.spread+"px",""+r].join(" ")})):""},t.prototype.generateCssClassName=function(t){var e=Math.random().toString(36).substring(2,6);return""+t.cssPrefix+e},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:r.StyleService},{type:a},{type:r.SymbolService},{type:r.LayerService}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(r.StyleService),e.ɵɵinject(a),e.ɵɵinject(r.SymbolService),e.ɵɵinject(r.LayerService))},token:t,providedIn:"root"}),t}();var l=function(){function t(t,e){this.formatService=t,this.cssContext=e,this.indentationSymbol="  ",this.hostStyle=[":host {",this.indentationSymbol+"display: block;",this.indentationSymbol+"position: relative;","}",""].join("\n")}return t.prototype.aggregate=function(t,e){var r=[];this.buildAstStyleSheet(r,t),this.postProcessCss(r),this.buildPseudoElementStyle(r,t);var o=this.reGenerateStyleSheet(r),n=this.formatService.normalizeName(t.name);return[{kind:"css",value:this.combineStyles(o),language:"css",uri:e.componentDir+"/"+n+".css"}]},t.prototype.combineStyles=function(t){return this.hostStyle+" \n"+t},t.prototype.reGenerateStyleSheet=function(t){var e=this;return t.filter((function(t){return t.declarations.length>0})).map((function(t){return e.generateCssStyle(t).join("\n")})).join("\n")},t.prototype.generateCssStyle=function(t){var e=this;return["."+t.className+" {",t.declarations.map((function(t){return e.indentationSymbol+t})).join("\n"),"}",""]},t.prototype.buildPseudoElementStyle=function(t,e){var r=this,o=function(e){e.layers&&Array.isArray(e.layers)&&e.layers.forEach((function(e){if(r.cssContext.identify(e)){var n=""+e.css.className;e.css.pseudoElements&&(Object.entries(e.css.pseudoElements).forEach((function(e){var r,o,s=i(e,2),a=s[0],c=s[1];r=n+":"+a,(o=Object.entries(c).map((function(t){var e=i(t,2);return e[0]+": "+e[1]+";"})))&&t.push({className:r,declarations:o})})),o(e))}}))};o(e)},t.prototype.buildAstStyleSheet=function(t,e){var r=this,o=function(e,n){e.layers&&Array.isArray(e.layers)&&e.layers.forEach((function(e){if(r.cssContext.identify(e)){var n=""+e.css.className,s=[];Object.entries(e.css.rules).forEach((function(t){var e=i(t,2),r=e[0],o=e[1];s.push(r+": "+o+";")})),a=n,(c=s)&&t.push({className:a,declarations:c}),o(e,[{className:""+e.css.className,declarations:s}])}var a,c}))};o(e,t)},t.prototype.postProcessCss=function(t){for(var e,r,o=[],i=0;i<t.length;i++)for(var s=i,a=t[i],c=new Set(a.declarations.sort());++s<t.length;){var l=t[s],u=new Set(l.declarations.sort());try{for(var p=n(Array.from(c.values())),f=p.next();!f.done;f=p.next()){var y=f.value;u.has(y)&&(o.push({className:a.className+", ."+l.className,key:y}),u.delete(y),c.delete(y))}}catch(t){e={error:t}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(e)throw e.error}}this.setValuesInAst(t,i,c,s,u)}this.reduceDuplicates(o,t)},t.prototype.reduceDuplicates=function(t,e){var r=t.reduce((function(t,e,r,o){return 0!==r&&t.hasOwnProperty(e.className)?t[e.className].declarations=s(t[e.className].declarations,[e.key]):t[e.className]={className:e.className,declarations:[e.key]},t}),{});Object.values(r).filter((function(t){return t.declarations.length>0})).map((function(t){return e.push({className:t.className,declarations:t.declarations})}))},t.prototype.setValuesInAst=function(t,e,r,o,n){t[e].declarations=Object.assign(Array.from(r.values())),t[o].declarations=Object.assign(Array.from(n.values()))},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:r.FormatService},{type:a}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(r.FormatService),e.ɵɵinject(a))},token:t,providedIn:"root"}),t}();var u=function(){function t(t,e,r){this.cssContext=t,this.cssParser=e,this.cssAggretatorService=r}return t.prototype.compute=function(t,e,r){this.cssParser.compute(t,e,this.compileOptions(r))},t.prototype.aggregate=function(t,e){return this.cssAggretatorService.aggregate(t,this.compileOptions(e))},t.prototype.identify=function(t){return this.cssContext.identify(t)},t.prototype.context=function(t){return this.cssContext.of(t)},t.prototype.compileOptions=function(t){return o({generateClassName:!0,cssPrefix:"xly_",componentDir:"components"},t)},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a},{type:c},{type:l}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(a),e.ɵɵinject(c),e.ɵɵinject(l))},token:t,providedIn:"root"}),t}();var p=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[r.SketchLibModule]}]}],t}();t.CssCodeGenModule=p,t.CssCodeGenService=u,t.ɵa=a,t.ɵb=c,t.ɵc=l,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=xlayers-css-codegen.umd.min.js.map